#
#{{ grains.website_name }} - vHost file
#Automatically generated file by Deployment Tool: {{ None|strftime("%A %B %d %Y %H:%M") }}
#

Header set X-Frame-Options SAMEORIGIN
Header always edit Set-Cookie (.*) "$1;HttpOnly;Secure"

#
########Custom Error Page added by Sanchita Halder#######
#

Alias /error/ "/var/www/error/"

<Directory "/var/www/error">
Allow from All
Satisfy Any
</Directory>

#
#######Redirect rule for 40X and 50X added by Sanchita Halder######
#

RedirectMatch 404 (.*)\.(bash|git|hg|log|svn|swp|tar|zip|tgz|cvs|sql)
RedirectMatch 404 (.*)\.(old)([0-9]?)
RedirectMatch 404 (.*)/dbtest\.php
RedirectMatch 404 (.*)/(1|index1|iprober|phpinfo|phpspy|test|timthumb|tz|webshell|adminer|secure|info|apc|memcache).php
RedirectMatch 404 (.*)/(author-panel|database|phpMyAdmin|webmaster|adminer)/?$
RedirectMatch 404 (.*)/(=|_mm|cgi|cvs|dbscripts|jsp|rnd|userfiles)

#Client Request Errors
##Bad Request
ErrorDocument 400 /error/ErrorPage.html
##Forbidden
ErrorDocument 403 /error/ErrorPage.html
##Not Found
ErrorDocument 404 /error/ErrorPage.html
##Request Time Out
ErrorDocument 408 /error/ErrorPage.html
##Unsupported Media Type
ErrorDocument 415 /error/ErrorPage.html

#Server Errors
##Internal Server Error
ErrorDocument 500 /error/ErrorPage.html
##Not Implemented
ErrorDocument 501 /error/ErrorPage.html
##Bad Gateway
ErrorDocument 502 /error/ErrorPage.html
##Service Unavailable
ErrorDocument 503 /error/ErrorPage.html
##Gateway Timeout
ErrorDocument 504 /error/ErrorPage.html

###################################################################







#Comment out below Directory section before go live.

<Directory /var/www/html/{{ grains.website_name|replace('.','_') }}>
    Options -Indexes FollowSymlinks
    AllowOverride All
    #SSLRequireSSL
    AuthName "*****DSU Login: Please use AD credentials to login*****"
    AuthType Kerberos
    Krb5Keytab /etc/auth_kerb.keytab
    KrbAuthRealm NESTLERACK.LOCAL
    KrbMethodNegotiate off
    KrbSaveCredentials off
    KrbVerifyKDC off
    Require valid-user
</Directory>

<VirtualHost *:80>
    ServerAdmin webmaster@{{ grains.website_name }}
    #default for non-drupal deployment
    DocumentRoot "/var/www/html/{{ grains.website_name|replace('.','_') }}"
    #use below for Drupal CMS deployment
    #DocumentRoot "/var/www/html/{{ grains.website_name|replace('.','_')/current/docroot }}"
    Options -Indexes FollowSymlinks
    ServerName {{ grains.website_name }}
    ServerAlias *.{{ grains.website_name }}
    ErrorLog "/var/log/httpd/{{ grains.website_name|replace('.','_') }}-error_log"
    CustomLog "/var/log/httpd/{{ grains.website_name|replace('.','_') }}-access_log" combined
</VirtualHost>

#<VirtualHost *:443>
#    ServerAdmin webmaster@granko.cz
#    #default for non-drupal deployment
#    #DocumentRoot "/var/www/html/{{ grains.website_name|replace('.','_') }}"
#    #use below for Drupal CMS deployment
#    #DocumentRoot "/var/www/html/{{ grains.website_name|replace('.','_')/current/docroot }}"
#    Options -Indexes FollowSymlinks
#    AllowOverride All
#    ServerName {{ grains.website_name }}
#    ServerAlias *.{{ grains.website_name }}
#    SSLEngine On
#    SSLCertificateFile "/etc/httpd/conf/ssl.crt/{{ grains.website_name }}.crt"
#    SSLCertificateKeyFile "/etc/httpd/conf/ssl.key/{{ grains.website_name }}.key"
#    SSLCertificateChainFile "/etc/httpd/conf/ssl.crt/DigiCertCA.crt"
#    ErrorLog "/var/log/httpd/{{ grains.website_name|replace('.','_') }}-ssl-error_log"
#    CustomLog "/var/log/httpd/{{ grains.website_name|replace('.','_') }}-access_log" common
#</VirtualHost>
